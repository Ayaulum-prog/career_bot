<?php
header('Content-Type: application/json; charset=utf-8');

$type = $_GET['type'] ?? '';
$lang = $_GET['lang'] ?? 'ru';
if ($lang !== 'kz') {
    $lang = 'ru';
}

// База вопросов RU
$questions_ru = [
    [
        "id" => 1,
        "text" => "Что вам больше всего нравится?",
        "options" => [
            ["text" => "Решать логические задачи, программировать", "category" => "it"],
            ["text" => "Помогать людям, заботиться о здоровье", "category" => "med"],
            ["text" => "Рисовать, придумывать дизайн, создавать контент", "category" => "art"],
            ["text" => "Работать с механизмами, техникой, строить", "category" => "eng"]
        ]
    ],
    [
        "id" => 2,
        "text" => "В какой ситуации вы чувствуете себя комфортнее всего?",
        "options" => [
            ["text" => "За компьютером, анализируя информацию", "category" => "it"],
            ["text" => "В общении с людьми, клиентами, пациентами", "category" => "med"],
            ["text" => "На сцене, в творческой мастерской, в студии", "category" => "art"],
            ["text" => "На объекте, в цеху, на стройке, в лаборатории", "category" => "eng"]
        ]
    ],
    [
        "id" => 3,
        "text" => "Что для вас звучит интереснее?",
        "options" => [
            ["text" => "Создавать приложения, сайты, чат-боты", "category" => "it"],
            ["text" => "Изучать организм, ставить диагнозы", "category" => "med"],
            ["text" => "Придумывать визуальные образы, рекламу, дизайн", "category" => "art"],
            ["text" => "Проектировать здания, машины, устройства", "category" => "eng"]
        ]
    ],
    [
        "id" => 4,
        "text" => "Какой тип учебных предметов вам ближе?",
        "options" => [
            ["text" => "Информатика, математика, физика", "category" => "it"],
            ["text" => "Биология, химия, анатомия", "category" => "med"],
            ["text" => "ИЗО, музыка, литература", "category" => "art"],
            ["text" => "Черчение, технология, физика", "category" => "eng"]
        ]
    ]
];

// База вопросов KZ
$questions_kz = [
    [
        "id" => 1,
        "text" => "Сізге ең қатты не ұнайды?",
        "options" => [
            ["text" => "Логикалық есептер шығару, бағдарламалау", "category" => "it"],
            ["text" => "Адамдарға көмектесу, денсаулыққа қамқор болу", "category" => "med"],
            ["text" => "Сурет салу, дизайн ойлап табу, контент жасау", "category" => "art"],
            ["text" => "Механизмдермен, техникамен жұмыс істеу, құрылыста болу", "category" => "eng"]
        ]
    ],
    [
        "id" => 2,
        "text" => "Қай жағдайда өзіңізді ең жайлы сезінесіз?",
        "options" => [
            ["text" => "Компьютерде ақпаратты талдап отыру", "category" => "it"],
            ["text" => "Адамдармен, клиенттермен, пациенттермен сөйлесу", "category" => "med"],
            ["text" => "Сахнада, шығармашылық шеберханада, студияда болу", "category" => "art"],
            ["text" => "Нысанда, цехта, құрылыс алаңында, зертханада болу", "category" => "eng"]
        ]
    ],
    [
        "id" => 3,
        "text" => "Қайсысы сізге қызықтырақ естіледі?",
        "options" => [
            ["text" => "Қосымшалар, сайттар, чат-боттар жасау", "category" => "it"],
            ["text" => "Ағзаны зерттеу, диагноз қою", "category" => "med"],
            ["text" => "Визуалды образдар, жарнама, дизайн ойлап табу", "category" => "art"],
            ["text" => "Ғимараттар, машиналар, құрылғылар жобалау", "category" => "eng"]
        ]
    ],
    [
        "id" => 4,
        "text" => "Қай пәндер сізге көбірек ұнайды?",
        "options" => [
            ["text" => "Информатика, математика, физика", "category" => "it"],
            ["text" => "Биология, химия, анатомия", "category" => "med"],
            ["text" => "Бейнелеу өнері, музыка, әдебиет", "category" => "art"],
            ["text" => "Сызу, технология, физика", "category" => "eng"]
        ]
    ]
];

// Описание направлений и профессий RU
$careerMap_ru = [
    "it" => [
        "professions" => [
            "Программист",
            "Веб-разработчик",
            "Инженер по данным",
            "Специалист по кибербезопасности"
        ],
        "description" => "IT-сфера подходит людям, которые любят логическое мышление, работу с компьютером, алгоритмы и технологии. Здесь важны внимательность к деталям и готовность постоянно учиться."
    ],
    "med" => [
        "professions" => [
            "Врач",
            "Медицинская сестра",
            "Фармацевт",
            "Клинический психолог"
        ],
        "description" => "Медицинские и помогающие профессии подходят тем, кто хочет работать с людьми, заботиться о здоровье и качестве жизни, умеет сопереживать и готов учиться много лет."
    ],
    "art" => [
        "professions" => [
            "Графический дизайнер",
            "Аниматор",
            "Маркетолог-креативщик",
            "Фотограф/видеооператор"
        ],
        "description" => "Творческая сфера для людей с развитым воображением, чувством стиля и желанием создавать визуальный или медиа-контент. Важны вкус, насмотренность и желание экспериментировать."
    ],
    "eng" => [
        "professions" => [
            "Инженер-строитель",
            "Инженер-механик",
            "Архитектор",
            "Инженер по автоматизации"
        ],
        "description" => "Инженерные профессии подходят тем, кто любит технику, конструкции, реальные объекты и практические задачи. Важны усидчивость, точность и ответственность."
    ]
];

// Описание направлений и профессий KZ
$careerMap_kz = [
    "it" => [
        "professions" => [
            "Бағдарламашы",
            "Веб-әзірлеуші",
            "Деректер инженері",
            "Киберқауіпсіздік маманы"
        ],
        "description" => "IT саласы логикалық ойлауды, компьютермен жұмысты, алгоритмдер мен заманауи технологияларды жақсы көретін адамдарға сай келеді. Мұнда ұқыптылық пен үздіксіз үйренуге дайындық маңызды."
    ],
    "med" => [
        "professions" => [
            "Дәрігер",
            "Мейірбике",
            "Фармацевт",
            "Клиникалық психолог"
        ],
        "description" => "Медицина және көмек көрсету саласындағы мамандықтар адамдармен жұмыс істегісі келетін, олардың денсаулығы мен өмір сапасына қамқор болатын, эмпатиясы жоғары және ұзақ оқуға дайын адамдарға лайық."
    ],
    "art" => [
        "professions" => [
            "Графикалық дизайнер",
            "Аниматор",
            "Маркетолог-креативші",
            "Фотограф/бейнеоператор"
        ],
        "description" => "Шығармашылық сала қиялы бай, стиль сезімі жоғары және визуалды немесе медиа-контент жасауды ұнататын адамдарға арналған. Мұнда талғам, байқампаздық және тәжірибе жасауға дайындық маңызды."
    ],
    "eng" => [
        "professions" => [
            "Құрылыс инженері",
            "Механика инженері",
            "Архитектор",
            "Автоматтандыру инженері"
        ],
        "description" => "Инженерлік мамандықтар техникамен, құрылғылармен, нақты нысандармен және практикалық міндеттермен жұмыс істегенді ұнататын адамдарға сәйкес. Дәлдік, жауапкершілік және жинақылық бұл салада өте маңызды."
    ]
];

// Выбор нужного языка
$questions = ($lang === 'kz') ? $questions_kz : $questions_ru;
$careerMap = ($lang === 'kz') ? $careerMap_kz : $careerMap_ru;

if ($type === 'questions') {
    echo json_encode($questions, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);
    exit;
}

if ($type === 'recommend') {
    $input = json_decode(file_get_contents('php://input'), true);
    $answers = $input['answers'] ?? [];

    if (empty($answers)) {
        echo json_encode([
            "error" => ($lang === 'kz') ? "Жауаптар жоқ" : "Нет ответов"
        ], JSON_UNESCAPED_UNICODE);
        exit;
    }

    // Подсчёт баллов по категориям
    $scores = [];
    foreach ($answers as $cat) {
        if (!isset($scores[$cat])) {
            $scores[$cat] = 0;
        }
        $scores[$cat]++;
    }

    arsort($scores);
    $topCategory = array_key_first($scores);

    $professions = $careerMap[$topCategory]['professions'] ?? [];
    $description = $careerMap[$topCategory]['description'] ?? '';

    echo json_encode([
        "topCategory" => $topCategory,
        "scores" => $scores,
        "professions" => $professions,
        "description" => $description
    ], JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);
    exit;
}

echo json_encode([
    "error" => ($lang === 'kz') ? "Қате сұрау түрі" : "Неверный тип запроса"
], JSON_UNESCAPED_UNICODE);
